# Keypad-STM32
Подключение матричной клавиатуры 4х3.

Имеется клавиатура такого вида

| 1 | 2 | 3 |

| 4 | 5 | 6 |

| 7 | 8 | 9 |

| * | 0 | # |

Столбцы матрицы заведены на GPIO порты условного микроконтроллера CLM_1-CLM_3, строки на порты ROW_1-ROW_4.
Реализуется алгоритм, позволяющий однозначно фиксировать короткое нажатие на одну клавишу, короткое нажатие на две клавиши, 
нажатие и удержание одной или двух клавиш в течение 1 секунды. При опросе матрицы учитывается подавление дребезга контакта.
Короткие нажатия на клавиши необходимо фиксировать в момент отпускания, длинные - по факту удержания, но только один раз. 
По факту определения нажатий необходимо вызывать функции:

void single_key_pressed(char key)

void double_key_pressed(char key, char key)

void single_key_long_pressed(char key)

void double_key_long_pressed(char key, char key)

В качестве микроконтроллера используется STM32F3x.

В такой клавиатуре первые 4 контакта отвечают за подачу сигнала на строки (в программе это выводы GPIO_ROW_1_PIN...GPIO_ROW_4_PIN 
настроены в режиме OPEN DRAIN для защиты от КЗ при нажатии нескольких клавиш), а последние 3 предназначены для считывания сигналов и 
настроены на вход с подтяжкой к "1"  (GPIO_CLM_1_PIN...GPIO_CLM_3_PIN).
Опрос клавиатуры организуется попеременной подачей низкого уровня сигнала на одну из строк, в это время на остальные подается высокий 
уровень. Определение нажатия клавиши будет проводиться путем сравнения считанного с входов значения с 1. В случае появления 
сигнала низкого уровня на входе это значение будет отличаться от 1. Определить, какая именно клавиша была нажата можно, проверив, на 
каком из столбцов разряд установлен в лог. 0.

Для реализации опроса клавиатуры используем 2 таймера. В прерывании по переполнению первого выполняется переключение сигналов для строк. 
В обработчике второго выполняется считывание сигналов и реакция на сочетание нажатых клавиш. Также использование системных таймеров 
позволяет избежать «регистрации» дребезга контактов и освобождает достаточно большое количество машинного времени, так как в программе 
полностью исключены функции задержек.
Для различия короткого и длинного нажатия используется константа KEY_SENSE и массив счетчиков для кнопок Key_input_count. Если значение в 
счетчике больше KEY_SENSE, значит кнопка удерживается дольше одной секунды.

Примечание: исходные файлы находятся в папке User.
